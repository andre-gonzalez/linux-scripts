#!/bin/sh
# Toggle Dunst Do Not Disturb mode.
# Supports:
#   do-not-disturb H M   -> hours + minutes
#   do-not-disturb H     -> hours only (minutes = 0)
#   do-not-disturb       -> just toggle without timer

status="$(dunstctl is-paused)"

HOURS="${1:-}"
MINUTES="${2:-0}"   # if only one arg given, second becomes 0

# If no arguments at all, both HOURS and MINUTES should be ignored
if [ -z "$1" ]; then
    TOTAL_SECONDS=0
else
    # Validate numeric input (optional but nice)
    if ! [ "$HOURS" -ge 0 ] 2>/dev/null; then
        echo "Invalid hours value: $HOURS" >&2
        exit 1
    fi
    if ! [ "$MINUTES" -ge 0 ] 2>/dev/null; then
        echo "Invalid minutes value: $MINUTES" >&2
        exit 1
    fi

    TOTAL_SECONDS=$(( HOURS * 3600 + MINUTES * 60 ))
fi

do_not_disturb_off() {
    dunstctl set-paused false
    notify-send "Do not disturb OFF"
    kill -48 "$(pidof dwmblocks)"
}

if [ "$status" = "false" ]; then
    dunstctl set-paused true
    echo "Do not disturb ON" | dmenu
    kill -48 "$(pidof dwmblocks)"

    # Only sleep if user provided a time
    if [ "$TOTAL_SECONDS" -gt 0 ]; then
        sleep "$TOTAL_SECONDS"
        do_not_disturb_off
    fi

elif [ "$status" = "true" ]; then
    do_not_disturb_off
fi
